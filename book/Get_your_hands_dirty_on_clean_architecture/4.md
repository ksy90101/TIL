# 4. ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„í•˜ê¸°

## ë„ë©”ì¸ ëª¨ë¸ êµ¬í˜„í•˜ê¸°

> í•œ ê³„ì¢Œì—ì„œ ë‹¤ë¥¸ ê³„ì¢Œë¡œ ì†¡ê°í•˜ëŠ” ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤.
> 

### Account ì—”í‹°í‹° ëª¨ë¸ë§

> ì…ê¸ˆê³¼ ì¶œê¸ˆì„ í•  ìˆ˜ ìˆëŠ” ê³„ì¢Œë¥¼ ì˜ë¯¸
> 

```jsx
package com.book.cleanarchitecture.buckpal.account.domain.vo;

public class AccountId {

    private final Long value;

    public AccountId(Long value) {
        this.value = value;
    }

    public Long getValue() {
        return value;
    }
}
```

```jsx
package com.book.cleanarchitecture.buckpal.account.domain;

import com.book.cleanarchitecture.buckpal.account.domain.vo.AccountId;
import com.book.cleanarchitecture.buckpal.account.domain.vo.Money;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;

public class Account {

    private final AccountId id;

    private final Money baselineBalance;

    private final ActivityWindow activityWindow;

    private Account(AccountId id, Money baselineBalance, ActivityWindow activityWindow) {
        this.id = id;
        this.baselineBalance = baselineBalance;
        this.activityWindow = activityWindow;
    }

    public static Account withId(
            AccountId accountId,
            Money baselineBalance,
            ActivityWindow activityWindow) {
        return new Account(accountId, baselineBalance, activityWindow);
    }
    
    public Money calculateBalance() {
        return this.baselineBalance.plus(this.activityWindow.calculateBalance(this.id));
    }

    public boolean withdraw(Money money, AccountId targetAccountId) {
        if (!mayWithdraw(money)) {
            return false;
        }

        Activity withdrawal = new Activity(this.id, this.id, targetAccountId, LocalDateTime.now(), money);
        this.activityWindow.addActivity(withdrawal);

        return true;
    }

    private boolean mayWithdraw(Money money) {
        return this.calculateBalance().plus(money.negate()).isPositiveOrZero();
    }

    public boolean deposit(Money money, AccountId sourceAccountId) {
        Activity deposit = new Activity(this.id, sourceAccountId, this.id, LocalDateTime.now(), money);
        this.activityWindow.addActivity(deposit);

        return true;
    }

    public Optional<AccountId> getId() {
        return Optional.ofNullable(this.id);
    }

    public List<Activity> getActivities() {
        return activityWindow.getActivities();
    }
}
```

- ëª¨ë“  í™œë™ë“¤ì„ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ë©´ í˜„ëª…í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ActivityWindowë¼ëŠ” VOë¥¼ ê°€ì§€ê³  ìˆê²Œ ëœë‹¤.
- baselineBalanceëŠ” ì²« ë²ˆì§¸ í™œë™ ë°”ë¡œ ì „ì˜ ì”ê³ ë¥¼ í‘œí˜„í•œë‹¤
- í˜„ì¬ ì´ ì”ê³ ëŠ” ê¸°ì¤€ ì”ê³ (baselineBalnce)ì— í™œë™ì°½ì˜ ëª¨ë“  í™œë™ë“¤ì˜ ì”ê³ ë¥¼ í•©í•œ ê°’ì´ ëœë‹¤.
- withdraw() ë©”ì„œë“œëŠ” ì¶œê¸ˆ / deposit() ë©”ì„œë“œëŠ” ì…ê¸ˆì„ ì˜ë¯¸í•œë‹¤.

### ActivityWindow ëª¨ë¸ë§

> ê³„ì¢Œì— ëŒ€í•œ ëª¨ë“  ì…ê¸ˆê³¼ ì¶œê¸ˆì€ Activity ì—”í‹°í‹°ì— í¬ì°©ë˜ë©°, ëª¨ë“  í™œë™ë“¤ì„ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ë©´ í˜„ëª…í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ActivityWindowë¼ëŠ” VOë¥¼ ê°€ì§€ê³  ìˆê²Œ ëœë‹¤.
> 

```jsx
package com.book.cleanarchitecture.buckpal.account.domain.vo;

public class ActivityId {

    private final Long value;

    public ActivityId(Long value) {
        this.value = value;
    }

    public Long getValue() {
        return value;
    }
}
```

```jsx
package com.book.cleanarchitecture.buckpal.account.domain;

import com.book.cleanarchitecture.buckpal.account.domain.vo.AccountId;
import com.book.cleanarchitecture.buckpal.account.domain.vo.Money;

import java.time.LocalDateTime;
import java.util.Arrays;
import java.util.Collections;
import java.util.Comparator;
import java.util.List;

public class ActivityWindow {

    private final List<Activity> activities;

    public ActivityWindow(List<Activity> activities) {
        this.activities = activities;
    }

    public ActivityWindow(Activity... activities) {
        this.activities = Arrays.asList(activities);
    }

    public LocalDateTime getStartTimestamp() {
        return activities.stream()
                .min(Comparator.comparing(Activity::getTimestamp))
                .orElseThrow(IllegalStateException::new)
                .getTimestamp();
    }

    public LocalDateTime getEndTimestamp() {
        return activities.stream()
                .max(Comparator.comparing(Activity::getTimestamp))
                .orElseThrow(IllegalStateException::new)
                .getTimestamp();
    }

    public Money calculateBalance(AccountId accountId) {
        Money depositBalance = activities.stream()
                .filter(activity -> activity.getTargetAccountId().equals(accountId))
                .map(Activity::getMoney)
                .reduce(Money.ZERO, Money::plus);

        Money withdrawalBalance = activities.stream()
                .filter(activity -> activity.getSourceAccountId().equals(accountId))
                .map(Activity::getMoney)
                .reduce(Money.ZERO, Money::plus);

        return depositBalance.plus(withdrawalBalance.negate());
    }

    public void addActivity(Activity activity) {
        this.activities.add(activity);
    }

    public List<Activity> getActivities() {
        return Collections.unmodifiableList(this.activities);
    }
}
```

### Money ëª¨ë¸ë§

> ëˆì„ ì˜ë¯¸í•œë‹¤.
> 

```jsx
package com.book.cleanarchitecture.buckpal.account.domain.vo;

import java.math.BigInteger;
import java.util.Objects;

public class Money {

    public static final Money ZERO = Money.of(0L);

    private final BigInteger amount;

    public Money(BigInteger amount) {
        this.amount = amount;
    }

    public static Money of(long value) {
        return new Money(BigInteger.valueOf(value));
    }

    public boolean isPositiveOrZero() {
        return this.amount.compareTo(BigInteger.ZERO) >= 0;
    }

    public boolean isGreaterThan(Money money) {
        return this.amount.compareTo(money.amount) >= 1;
    }

    public Money minus(Money money) {
        return new Money(this.amount.subtract(money.amount));
    }

    public Money plus(Money money) {
        return new Money(this.amount.add(money.amount));
    }

    public Money negate() {
        return new Money(this.amount.negate());
    }

    public BigInteger getAmount() {
        return amount;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Money money = (Money) o;
        return amount.equals(money.amount);
    }

    @Override
    public int hashCode() {
        return Objects.hash(amount);
    }
}
```

## ìœ ìŠ¤ì¼€ì´ìŠ¤ ë‘˜ëŸ¬ë³´ê¸°

### ë‹¨ê³„

1. ì…ë ¥ì„ ë°›ëŠ”ë‹¤.
2. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ê²€ì¦í•œë‹¤.
3. ëª¨ë¸ ìƒíƒœë¥¼ ì¡°ì‘í•œë‹¤.
4. ì¶œë ¥ì„ ë°˜í™˜í•œë‹¤.

### ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦ì´ë€?

ìœ ìŠ¤ì¼€ì´ìŠ¤ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ê²€ì¦í•  ì±…ì„ì´ ìˆê³ , ë„ë©”ì¸ì¸ ì—”í‹°í‹°ì™€ ì´ ì±…ì„ì„ ê³µìœ í•œë‹¤. í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ê°€ í•˜ë‚˜ì˜ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³ , ë„ë©”ì¸ ëª¨ë¸ì„ ë³€ê²½í•˜ê³ , ë³€ê²½ëœ ìƒíƒœë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ì•„ì›ƒê³ ì‰ í¬íŠ¸ë¥¼ í˜¸ì¶œí•œë‹¤.

```jsx
package com.book.cleanarchitecture.buckpal.application.service;

import com.book.cleanarchitecture.buckpal.application.port.in.SendMoneyCommand;
import org.springframework.transaction.annotation.Transactional;

@Transactional
public class SendMoneyService implements SendMoneyUseCase {
    private final LoadAccountPort loadAccountPort;
    private final AccountLock accountLock;
    private final UpdateAccountStatePort updateAccountStatePort;

    public SendMoneyService(LoadAccountPort loadAccountPort, AccountLock accountLock, UpdateAccountStatePort updateAccountStatePort) {
        this.loadAccountPort = loadAccountPort;
        this.accountLock = accountLock;
        this.updateAccountStatePort = updateAccountStatePort;
    }

    @Override
    public boolean sendMoney(SendMoneyCommand command) {
        // Todo ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
        // Todo ëª¨ë¸ ìƒíƒœ ì¡°ì‘
        // Todo ì¶œë ¥ ê°’ ë°˜í™˜
    }
}
```

## ì…ë ¥ ìœ íš¨ì„± ê²€ì¦

ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µì—ì„œ ìœ íš¨ì„±ì„ ê²€ì¦í•´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ê·¸ë ‡ê²Œ í•˜ì§€ ì•Šì„ ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ì–´ì˜ ë°”ê¹¥ìª½ìœ¼ë¡œë¶€í„° ìœ íš¨í•˜ì§€ ì•Šì€ ì…ë ¥ê°’ì„ ë°›ê²Œ ë˜ê³ , ëª¨ë¸ì˜ ìƒíƒœë¥¼ í•´ì¹ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. ë”°ë¼ì„œ ì…ë ¥ ëª¨ë¸(input model)ì„ ì´ ë¬¸ì œë¥¼ ë‹¤ë£¨ë„ë¡ í•œë‹¤.

```jsx
package com.book.cleanarchitecture.buckpal.shared;

import javax.validation.*;
import java.util.Set;

public abstract class SelfValidating<T> {

    private final Validator validator;

    protected SelfValidating() {
        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();
        this.validator = factory.getValidator();
    }

    protected void validateSelf() {
        Set<ConstraintViolation<T>> violations = validator.validate((T) this);
        if (!violations.isEmpty()) {
            throw new ConstraintViolationException(violations);
        }
    }
}
```

```jsx
package com.book.cleanarchitecture.buckpal.account.application.port.in;

import com.book.cleanarchitecture.buckpal.account.domain.vo.AccountId;
import com.book.cleanarchitecture.buckpal.account.domain.vo.Money;
import com.book.cleanarchitecture.buckpal.shared.SelfValidating;

import javax.validation.constraints.NotNull;

public class SendMoneyCommand extends SelfValidating<SendMoneyCommand> {

    @NotNull
    private final AccountId sourceAccountId;

    @NotNull
    private final AccountId targetAccountId;

    @NotNull
    private final Money money;

    public SendMoneyCommand(AccountId sourceAccountId, AccountId targetAccountId, Money money) {
        this.sourceAccountId = sourceAccountId;
        this.targetAccountId = targetAccountId;
        this.money = money;
        this.validateSelf();
    }

    public AccountId getSourceAccountId() {
        return sourceAccountId;
    }

    public AccountId getTargetAccountId() {
        return targetAccountId;
    }

    public Money getMoney() {
        return money;
    }
}
```

- finalì„ ì´ìš©í•´ ë¶ˆë³€ í•„ë“œë¡œ ë§Œë“¤ê³ , ì´í›„ì— ì˜ëª»ëœ ìƒíƒœë¡œ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤ëŠ” ì‚¬ì‹¤ì„ ë³´ì¥í•˜ì.
- Java Bean Validation APIë¥¼ ì´ìš©í•´ ì‘ì—…í•˜ê¸° ìœ„í•´ SelfValidatingì´ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì—ˆë‹¤.
- ì…ë ¥ ëª¨ë¸ì— ìˆëŠ” ìœ íš¨ì„± ê²€ì¦ ì½”ë“œë¥¼ í†µí•´ ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„ì²´ ì£¼ìœ„ì— ì‚¬ì‹¤ìƒ ì˜¤ë¥˜ ë°©ì§€ ê³„ì¸µ(anti corruption layer)ì„ ë§Œã„·ë¥´ì—ˆë‹¤.

<aside>
ğŸ’¡ ì˜¤ë¥˜ ë°©ì§€ ê³„ì¸µì´ë€?
í•˜ë‚˜ì˜ ë°”ìš´ë””ë“œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë‹¤ë¥¸ ë°”ìš´ë””ë“œ ì»¨í…ìŠ¤íŠ¸ì™€ ê²©ë¦¬ì‹œí‚¤ëŠ” ê³„ì¸µ

</aside>

## ìœ ìŠ¤ì¼€ì´ìŠ¤ë§ˆë‹¤ ë‹¤ë¥¸ ì…ë ¥ ëª¨ë¸

> ê°ê¸° ë‹¤ë¥¸ ìœ ìŠ¤ì¼€ì´ìŠ¤ì— ë™ì¼í•œ ì…ë ¥ ëª¨ë¸ì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤ë©´?
> 

ë¶ˆë³€ ì»¤ë§¨ë“œ ê°ì²´ì˜ í•„ë“œì— ëŒ€í•´ì„œ nullì„ ìœ íš¨í•œ ìƒíƒœë¡œ ë°›ì•„ë“¤ì´ëŠ” ê²ƒì€ ê·¸ ìì²´ë¡œ ì½”ë“œ ëƒ„ìƒˆë‹¤. ë“±ë¡ ìœ ìŠ¤ì¼€ì´ìŠ¤ì™€ ì—…ë°ì´íŠ¸ ìœ ìŠ¤ì¼€ì´ìŠ¤ëŠ” ì„œë¡œ ë‹¤ë¥¸ ìœ íš¨ì„± ê²€ì¦ ë¡œì§ì´ í•„ìš”í•˜ë‹¤. ì•„ë§ˆë„ ìœ ìŠ¤ì¼€ì´ìŠ¤ì— ì»¤ìŠ¤í…€ ìœ íš¨ì„± ê²€ì¦ ë¡œì§ì„ ë„£ì–´ì•¼ í•  í…Œê³ , ì´ëŠ” ì‹ ì„±í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œë¥¼ ì…ë ¥ ìœ íš¨ì„± ê²€ì¦ê³¼ ê´€ë ¨ëœ ê´€ì‹¬ì‚¬ë¡œ ì˜¤ì—¼ì‹œí‚¨ë‹¤. ê° ìœ ìŠ¤ì¼€ì´ìŠ¤ ì „ìš© ì…ë ¥ ëª¨ë¸ì€ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ í›¨ì”¬ ëª…í™•í•˜ê²Œ ë§Œë“¤ê³  ë‹¤ë¥¸ ìœ ìŠ¤ì¼€ì´ìŠ¤ì™€ì˜ ê²°í•©ë„ ì œê±°í•´ì„œ ë¶ˆí•„ìš”í•œ ë¶€ìˆ˜íš¨ê³¼ê°€ ë°œìƒí•˜ì§€ ì•Šê²Œ í•œë‹¤.

## ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦í•˜ê¸°

> ì…ë ¥ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ëŠ” ê²ƒì€ êµ¬ë¬¸ìƒì˜(syntactical) ìœ íš¨ì„±ì„ ê²€ì¦í•˜ëŠ” ê²ƒì´ë¼ê³ ë„ í•  ìˆ˜ ìˆë‹¤. ë°˜ë©´ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì€ ìœ ìŠ¤ì¼€ì´ìŠ¤ì˜ ë§¥ë½ ì†ì—ì„œ ì˜ë¯¸ì ì¸(semantical) ìœ íš¨ì„±ì„ ê²€ì¦í•˜ëŠ” ì¼ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.
> 

ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ë„ë©”ì¸ ì—”í‹°í‹° ì•ˆì— ë„£ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ë‹¤.ê·œì¹™ì„ ì§€ì¼œì•¼ í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë°”ë¡œ ì˜†ì— ê·œì¹™ì´ ìœ„ì¹˜í•˜ê¸° ë•Œë¬¸ì— ìœ„ì¹˜ë¥¼ ì •í•˜ëŠ” ê²ƒë„ ì‰½ê³  ì¶”ë¡ í•˜ê¸°ë„ ì‰½ë‹¤. ë„ë©”ì¸ ì—”í‹°í‹°ì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ê²€ì¦í•˜ê¸°ê°€ ì—¬ì˜ì¹˜ ì•Šë‹¤ë©´ ìœ ìŠ¤ì¼€ì´ìŠ¤ ì½”ë“œì—ì„œ ë„ë©”ì¸ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— í•´ë„ ëœë‹¤.

```jsx
package com.book.cleanarchitecture.buckpal.doamin;

import com.book.cleanarchitecture.buckpal.doamin.vo.AccountId;

import java.time.LocalDateTime;

public class Account {

    private final AccountId id;
    private final Money baselineBalance;
    private final ActivityWindow activityWindow;

    public Account(AccountId id, Money baselineBalance, ActivityWindow activityWindow) {
        this.id = id;
        this.baselineBalance = baselineBalance;
        this.activityWindow = activityWindow;
    }

    public Money calculateBalance() {
        return this.baselineBalance.plus(this.activityWindow.calculateBalance(this.id));
    }

    public boolean withdraw(Money money, AccountId targetAccountId) {
        if(!mayWithdraw(money)) {
            return false;
        }

				// ...
    }
}
```

```jsx
package com.book.cleanarchitecture.buckpal.application.service;

import com.book.cleanarchitecture.buckpal.application.port.in.SendMoneyCommand;
import org.springframework.transaction.annotation.Transactional;

@Transactional
public class SendMoneyService implements SendMoneyUseCase {
    private final LoadAccountPort loadAccountPort;
    private final AccountLock accountLock;
    private final UpdateAccountStatePort updateAccountStatePort;

    public SendMoneyService(LoadAccountPort loadAccountPort, AccountLock accountLock, UpdateAccountStatePort updateAccountStatePort) {
        this.loadAccountPort = loadAccountPort;
        this.accountLock = accountLock;
        this.updateAccountStatePort = updateAccountStatePort;
    }

    @Override
    public boolean sendMoney(SendMoneyCommand command) {
        requireAccountExists(command.getSourceAccountId());
        requireAccountExists(command.getTargetAccountId());
    }
}
```

## í’ë¶€í•œ ë„ë©”ì¸ ëª¨ë¸ vs ë¹ˆì•½í•œ ë„ë©”ì¸ ëª¨ë¸

### í’ë¶€í•œ ë„ë©”ì¸ ëª¨ë¸ì´ë€?

ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì½”ì–´ì— ìˆëŠ” ì—”í‹°í‹°ì—ì„œ ê°€ëŠ¥í•œ í•œ ë§ì€ ë„ë©”ì¸ ë¡œì§ì´ êµ¬í˜„ëœë‹¤. ì—”í‹°í‹°ë“¤ì€ ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ë©”ì„œë“œë¥¼ ì œê³µí•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì— ë§ëŠ” ìœ íš¨í•œ ë³€ê²½ë§Œ í—ˆìš©í•œë‹¤.

### ë¹ˆì•½í•œ ë„ë©”ì¸ ëª¨ë¸ì´ë€?

ì¼ë°˜ì ìœ¼ë¡œ ìƒíƒœë¥¼ í‘œí˜„í•˜ëŠ” í•„ë“œì™€ getter, setterë§Œ í¬í•¨í•˜ê³  ì–´ëŠ ë„ë©”ì¸ ë¡œì§ë„ ê°€ì§€ê³  ìˆì§€ ì•Šë‹¤. ë„ë©”ì¸ ë¡œì§ì´ ìœ ìŠ¤ì¼€ì´ìŠ¤ í´ë˜ìŠ¤ì— êµ¬í˜„ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì´ê³ , ì—”í‹°í‹°ë¥¼ ì „ë‹¬í•  ì±…ì„ ì—­ì‹œ ìœ ìŠ¤ì¼€ì´ìŠ¤ í´ë˜ìŠ¤ì— ìˆë‹¤.

### ë‘˜ ì¤‘ì— ë¬´ì—‡ì´ ì¢‹ì€ê°€?

ê°ìì˜ í•„ìš”ì— ë§ëŠ” ìŠ¤íƒ€ì¼ì„ ììœ ë¡­ê²Œ ì„ íƒí•˜ë©´ ë˜ì§€ë§Œ, ë‚˜ëŠ” í’ë¶€í•œ ë„ë©”ì¸ ëª¨ë¸ì´ ë” ì¢‹ë‹¤ê³  ìƒê°í•œë‹¤

## ìœ ìŠ¤ì¼€ì´ìŠ¤ë§ˆë‹¤ ë‹¤ë¥¸ ì¶œë ¥ ëª¨ë¸

> ë§Œì•½ ì˜ì‹¬ìŠ¤ëŸ½ë‹¤ë©´ ê°€ëŠ¥í•œ í•œ ì ê²Œ ë°˜í™˜í•˜ì.
> 

ìœ ìŠ¤ì¼€ì´ìŠ¤ë“¤ ê°„ì— ê°™ì€ ì¶œë ¥ ëª¨ë¸ì„ ê³µìœ í•˜ê²Œ ë˜ë©´ ìœ ìŠ¤ì¼€ì´ìŠ¤ë“¤ë„ ê°•í•˜ê²Œ ê²°í•©ëœë‹¤. í•œ ìœ ìŠ¤ì¼€ì´ìŠ¤ì—ì„œ ì¶œë ¥ ëª¨ë¸ì— ìƒˆë¡œìš´ í•„ë“œê°€ í•„ìš”í•´ì§€ë©´ ì´ ê°’ê³¼ ê´€ë ¨ì´ ì—†ëŠ” ë‹¤ë¥¸ ìœ ìŠ¤ì¼€ì´ìŠ¤ì—ì„œë„ ì´ í•„ë“œë¥¼ ì²˜ë¦¬í•´ì•¼ í•œë‹¤. ê³µìœ  ëª¨ë¸ì€ ì¥ê¸°ì ìœ¼ë¡œ ë´¤ì„ ë•Œ ê°–ê°€ì§€ ì´ìœ ë¡œ ì ì  ì»¤ì§€ê²Œ ë¼ ìˆë‹¤. ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì ìš©í•˜ê³  ëª¨ë¸ì„ ë¶„ë¦¬í•´ì„œ ìœ ì§€í•˜ëŠ” ê²ƒì€ ìœ ìŠ¤ì¼€ì´ìŠ¤ì˜ ê²°í•©ì„ ì œê±°í•˜ëŠ” ë° ë„ì›€ì´ ëœë‹¤.

## ì½ê¸° ì „ìš© ìœ ìŠ¤ì¼€ì´ìŠ¤ëŠ” ì–´ë–¨ê¹Œ?

> ì¿¼ë¦¬ë¥¼ ìœ„í•œ ì¸ì»¤ë° ì „ìš© í¬íŠ¸ë¥¼ ë§Œë“¤ê³  ì´ë¥¼ ì¿¼ë¦¬ ì„œë¹„ìŠ¤ì— êµ¬í˜„í•˜ëŠ” ê²ƒì´ë‹¤.
> 

```jsx
package com.book.cleanarchitecture.buckpal.account.application.service;

import com.book.cleanarchitecture.buckpal.account.application.port.in.GetAccountBalanceQuery;
import com.book.cleanarchitecture.buckpal.account.application.port.out.LoadAccountPort;
import com.book.cleanarchitecture.buckpal.account.domain.vo.AccountId;
import com.book.cleanarchitecture.buckpal.account.domain.vo.Money;

import java.time.LocalDateTime;

public class GetAccountBalanceService implements GetAccountBalanceQuery {
    private final LoadAccountPort loadAccountPort;

    public GetAccountBalanceService(LoadAccountPort loadAccountPort) {
        this.loadAccountPort = loadAccountPort;
    }

    @Override
    public Money getAccountBalance(AccountId accountId) {
        return loadAccountPort.loadAccount(accountId, LocalDateTime.now())
                .calculateBalance();
    }
}
```

ì´ ì²˜ëŸ¼ ì½ê¸° ì „ìš© ì¿¼ë¦¬ëŠ” ì“°ê¸°ê°€ ê°€ëŠ¥í•œ ìœ ìŠ¤ì¼€ì´ìŠ¤(ë˜ëŠ” ì»¤ë§¨ë“œ)ì™€ ì½”ë“œ ìƒì—ì„œ ëª…í™•í•˜ê²Œ êµ¬ë¶„ëœë‹¤. ì´ëŸ° ë°©ì‹ì€ CQS(Command-Query Separation)ë‚˜ CQRS(Command-Query Responsibility Segregation)ê°™ì€ ê°œë…ê³¼ ì•„ì£¼ ì˜ ë§ëŠ”ë‹¤.

<aside>
ğŸ’¡ CQRSë€
ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ì‘ì—…ê³¼ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ì‘ì—…ì˜ ì±…ì„ì„ ë¶„ë¦¬í•˜ëŠ” íŒ¨í„´ìœ¼ë¡œì„œ ëª…ëª… ì¿¼ë¦¬ ì±…ì„ ë¶„ë¦¬ë¡œ ì§ì˜ëœë‹¤.

</aside>

## ì¶œì²˜

- [ë§Œë“¤ë©´ì„œ ë°°ìš°ëŠ” í´ë¦° ì•„í‚¤í…ì²˜ - ìë°” ì½”ë“œë¡œ êµ¬í˜„í•˜ëŠ” í´ë¦° ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=283437942)
