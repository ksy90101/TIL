# 7장. 도메인 서비스

## 여러 애그리거트가 필요한 기능

- 결제 기능을 구현한다고 하면, 상품 / 주문 / 할인 쿠폰 / 회원 등 여러개의 어그리게이트가 필요하다. 이때 주체는 어떤 애그리거트일까?
- 일단 생각해볼 수 있는 방법은 주문 애그리거트가 필요한 애그리거트나 필요 데이터를 모두 가지게 한 뒤 할인 금액 계산 책임을 주문 애그리거트에 할당하는 것이다. 그러나 할인 금액 책임이 과연 주문 애그리거트의 책임일지 생각해봐야 한다.
- 위와 같이 한 애그리거트에 넣기에 애매한 도메인 기능을 특정 애그리거트 억지로 구현하면 책임 범위를 넘어선 기능을 구현하게 되며 외부에 대한 의존성이 높아지게 되고 복잡성이 높아져 수정하기 어려워 진다.
- 이때 방법은 바로 도메인 서비스를 별도로 구현하는 것이다.

## 도메인 서비스

- 도메인 서비스의 도메인 영역의 애그리거트와 밸류와 다른 점은 상태 없이 오직 로직만 구현한다는 것이다. 도메인 서비스를 구현하는 데 필요한 상태는 애그리거트나 다른 방법으로 전달받는다.
- 도메인 서비스는 단순히 도메인 로직을 수행하지 응용 로직을 수행하지 않는다. 따라서 트랜잭션 처리와 같은 로직은 응용 로직이므로 도메인 서비스가 아닌 응용 서비스에서 처리해야 한다.

### 도메인 서비스 객체를 애그리거트에 주입하지 않기

- 애그리거트 루트 엔티티에 도메인 서비스에 대한 참조를 추가하는 것은 좋은 방법이 아니다. 도메인 객체는 필드로 구성된 데이터와 메서드를 이용한 기능을 이용해 개념적으로 하나인 모델을 표현한다.

### 도메인 서비스의 패키지 위치

- 도메인 로직을 수행하기 때문에 애그리거트가 있는 패키지에 넣는 것이 좋다.

### 도메인 서비스의 인터페이스와 클래스

- 도메인 서비스의 로직이 고정되어 있는 않은 경우 도메인 서비스 자체를 인터페이스로 구현하고 이를 구현한 클래스를 둘수도 있다. 이때 도메인 영역은 도메인 서비스 인터페이스가 위치하고 실제 구현한 인프라스트럭처 영역에 의존할 수 있다.
- 특정 구현 기술에 의존적이거나 외부 시스템의 API를 실행한다면 인터페이스로 추상화 하는 것이 좋다.